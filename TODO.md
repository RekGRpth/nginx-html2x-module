
###
```
server {
  listen 80;

  location / {
    pdf;
  }
}
```

`pdf` - обрабатывает POST запрос.
в теле POST запроса передается HTML документ из которого генерируется и возвращается PDF.
может принимать GET аргументы для передачи параметров вроде размера страницы.

###
+ Научить html_to_pdf брать html не из урла, а из буфера.
+ Научить html_to_pdf писать pdf не в файл, а в буфер.
- Написать интерфейс в ngx_http_pdf_wkhtmltopdf для генерации pdf
  * передаём буффер с html и указатель на выходной буфер
  * возвращаем размер pdf

wk:
  - wkhtmltopdf_init
  - wk_gs
  - wk_os
  - wk_c = new(wk_gs)
  - add_callback
  - add_object
  - convert
  - get_output

nginx:
  init:
  request:

###
Если тело запроса попало на диск, то нужно научиться его вычитывать с диска и передавать в pdf конвертор:
 - есть r->request_body->bufs, это список buf, в котором есть поле in_file/memory. по ним можно смотреть где файл
 - в r->request_body->chunked есть информация, разбито ли тело на части
 - есть функция ngx_http_parse_chunked собирающая чанки, но кажется это не про файлы т.к. в функции нет ничего про работу с file
 - есть макросы ngx_buf_in_memory и ngx_buf_in_memory_only которые возвращают 0/1 если файл в памяти или он только в памяти
 - есть функция ngx_file_aio_read для загрузки файла в буффер в асинхронном режиме
 - ngx_output_chain_ctx_t используется вместе с ngx_http_get_module_ctx но кажется это нужно для nginx и в api не используется
 - ngx_read_file функция для чтения файла в буффер (наконецто!)

 План:
  - используем ngx_read_file в случаях, когда запрос упал в файл
  - вычитываем из файла в буффер
  - буффер добавляем как объект в pdf конвертор

###
  - src/ngx_http_pdf_module.c:178 #кажется вместо новых алокаций после add_object можно попробовать переиспользовать имеющиеся буферы

